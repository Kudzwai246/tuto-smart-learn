// android/settings.gradle - Simplified settings for stable builds
rootProject.name = "tuto-smart-learn"

// Always include your app module
include ':app'

// Note: capacitor-cordova-android-plugins is not included as a project
// because it lacks a proper build.gradle file. We only use its cordova.variables.gradle
// which is applied directly in capacitor.build.gradle

// Simplified Capacitor Android inclusion - reduced logging for stability
def nodeModules = new File(rootDir, "../node_modules")

// Find and include Capacitor Android core
def capacitorAndroidPath = null
if (new File(nodeModules, "@capacitor/android/capacitor").exists()) {
    capacitorAndroidPath = new File('../node_modules/@capacitor/android/capacitor')
} else if (new File(nodeModules, "@capacitor/android").exists()) {
    capacitorAndroidPath = new File('../node_modules/@capacitor/android')
}

if (capacitorAndroidPath != null && capacitorAndroidPath.exists()) {
    include ':capacitor-android'
    project(':capacitor-android').projectDir = capacitorAndroidPath
}

// Enhanced helper function for plugin inclusion with proper validation
def includeIfExists = { name, relPath ->
    def f = new File(rootDir, "../node_modules/@capacitor/${relPath}")
    if (f.exists() && f.isDirectory()) {
        // Check if it's a valid Android module (has build.gradle)
        def buildGradle = new File(f, "build.gradle")
        if (buildGradle.exists()) {
            include ":${name}"
            project(":${name}").projectDir = f
            println "✓ Successfully included Capacitor plugin: ${name}"
            return true
        } else {
            println "⚠ Skipping ${name}: No build.gradle found at ${f.absolutePath}"
        }
    } else {
        println "⚠ Skipping ${name}: Directory not found at ${f.absolutePath}"
    }
    return false
}

// Include common Capacitor plugins with validation
includeIfExists('capacitor-app', 'app/android')
includeIfExists('capacitor-haptics', 'haptics/android')
includeIfExists('capacitor-keyboard', 'keyboard/android')
includeIfExists('capacitor-status-bar', 'status-bar/android')
